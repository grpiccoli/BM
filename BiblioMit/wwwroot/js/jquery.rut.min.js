//!     jQuery.rut.js
(function(n){function t(n){return n.replace(/[\.\-]/g,"")}function f(n,t){var f=i(n),r=f[0],e=f[1],u,o;if(!(r&&e))return r||n;for(u="",o=t?".":"";r.length>3;)u=o+r.substr(r.length-3)+u,r=r.substring(0,r.length-3);return r+u+"-"+e}function s(n){return n.type&&n.type.match(/^key(up|down|press)/)&&(n.keyCode===8||n.keyCode===16||n.keyCode===17||n.keyCode===18||n.keyCode===20||n.keyCode===27||n.keyCode===37||n.keyCode===38||n.keyCode===39||n.keyCode===40||n.keyCode===91)}function e(n,i){var r,e,s,f;if(typeof n!="string")return!1;if(r=t(n),typeof i.minimumLength=="boolean"){if(i.minimumLength&&r.length<u.minimumLength)return!1}else if(e=parseInt(i.minimumLength,10),r.length<e)return!1;return(s=r.charAt(r.length-1).toUpperCase(),f=parseInt(r.substr(0,r.length-1)),isNaN(f))?!1:o(f).toString().toUpperCase()===s}function o(n){var t=0,r=2,i;if(typeof n=="number"){for(n=n.toString(),i=n.length-1;i>=0;i--)t=t+n.charAt(i)*r,r=(r+1)%8||2;switch(t%11){case 1:return"k";case 0:return 0;default:return 11-t%11}}}function h(n,t){n.val(f(n.val(),t))}function c(n){e(n.val(),n.opts)?n.trigger("rutValido",i(n.val())):n.trigger("rutInvalido")}function i(n){var i=t(n),r,u;return i.length===0?[null,null]:i.length===1?[i,null]:(r=i.charAt(i.length-1),u=i.substring(0,i.length-1),[u,r])}var u={validateOn:"blur",formatOn:"blur",ignoreControlKeys:!0,useThousandsSeparator:!0,minimumLength:2},r={init:function(t){var r,i;if(this.length>1)for(r=0;r<this.length;r++)console.log(this[r]),n(this[r]).rut(t);else i=this,i.opts=n.extend({},u,t),i.opts.formatOn&&i.on(i.opts.formatOn,function(n){i.opts.ignoreControlKeys&&s(n)||h(i,i.opts.useThousandsSeparator)}),i.opts.validateOn&&i.on(i.opts.validateOn,function(){c(i)});return this}};n.fn.rut=function(t){if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("El mÃ©todo "+t+" no existe en jQuery.rut");else return r.init.apply(this,arguments)};n.formatRut=function(n,t){return t===undefined&&(t=!0),f(n,t)};n.computeDv=function(n){var i=t(n);return o(parseInt(i,10))};n.validateRut=function(t,r,u){if(u=u||{},e(t,u)){var f=i(t);return n.isFunction(r)&&r(f[0],f[1]),!0}return!1}})(jQuery);